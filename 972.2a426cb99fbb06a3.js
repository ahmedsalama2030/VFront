"use strict";(self.webpackChunkvelzon=self.webpackChunkvelzon||[]).push([[972],{30146:(R,f,n)=>{n.d(f,{p:()=>g});var e=n(67569),p=n(45312),m=n(54438),_=n(21626);let g=(()=>{class l extends e.d{constructor(i){super(i,p.c.apiUrl+"ApprovalRequest/")}get(i){return this.http.post(this.baseUrl+"Get",i)}getPending(){return this.http.get(this.baseUrl+"PendingStepsForUser")}GetStepsById(i){return this.http.get(this.baseUrl+"Steps/"+i)}GetEmployeeLookup(){return this.http.get(this.baseUrl+"GetEmployeeLookup")}deleteTarget(i){return this.http.delete(this.baseUrl+i)}edit(i,u){return this.http.put(this.baseUrl+"Edit/"+i,u)}approve(i){return this.http.put(this.baseUrl+"Approve",i)}reject(i){return this.http.put(this.baseUrl+"Reject",i)}rollBack(i){return this.http.put(this.baseUrl+"RollBack",i)}sendToApproval(i){return this.http.post(this.baseUrl+"SendToApproval/"+i,{})}requestDetail(i){return this.http.get(this.baseUrl+"requestDetail/"+i)}GetRequestCount(){return this.http.get(this.baseUrl+"getRequestCount/")}GetRequestLookups(){return this.http.get(this.baseUrl+"GetRequestLookups/")}UpdateLimit(i){return this.http.get(this.baseUrl+"UpdateLimit/"+i)}GetApprovalRequestCount(){return this.http.get(this.baseUrl+"GetApprovalRequestCount")}GetApprovalStepsByMaster(i){return this.http.post(this.baseUrl+"GetApprovalStepsByMaster",i)}GetApprovalRequestSteps(i){return this.http.get(this.baseUrl+"GetApprovalRequestSteps/"+i)}static{this.\u0275fac=function(u){return new(u||l)(m.KVO(_.Qq))}}static{this.\u0275prov=m.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}}return l})()},55999:(R,f,n)=>{n.d(f,{T:()=>g});var e=n(67569),p=n(45312),m=n(54438),_=n(21626);let g=(()=>{class l extends e.d{constructor(i){super(i,p.c.apiUrl+"CustomerRequest/")}GetLookups(){return this.http.get(this.baseUrl+"GetLookups")}GetRequestLookups(){return this.http.get(this.baseUrl+"GetRequestLookups")}GetRequestCount(){return this.http.get(this.baseUrl+"GetRequestCount")}ViewRequest(i){return this.http.get(this.baseUrl+"ViewRequest/"+i)}Send(i){return this.http.put(this.baseUrl+"Send/"+i,{})}static{this.\u0275fac=function(u){return new(u||l)(m.KVO(_.Qq))}}static{this.\u0275prov=m.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}}return l})()},17478:(R,f,n)=>{n.d(f,{u:()=>g});var e=n(67569),p=n(45312),m=n(54438),_=n(21626);let g=(()=>{class l extends e.d{constructor(i){super(i,p.c.apiUrl+"RequestPersonSales/")}UpdateLimit(i){return this.http.post(this.baseUrl+"UpdateLimit",i)}GetRequestLookups(){return this.http.get(this.baseUrl+"GetRequestLookups")}GetRequestCount(){return this.http.get(this.baseUrl+"GetRequestCount")}ViewRequest(i){return this.http.get(this.baseUrl+"ViewRequest/"+i)}Send(i){return this.http.put(this.baseUrl+"Send/"+i,{})}static{this.\u0275fac=function(u){return new(u||l)(m.KVO(_.Qq))}}static{this.\u0275prov=m.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}}return l})()},57415:(R,f,n)=>{n.d(f,{Z:()=>g});var e=n(67569),p=n(45312),m=n(54438),_=n(21626);let g=(()=>{class l extends e.d{constructor(i){super(i,p.c.apiUrl+"SalesRequest/")}PrintReport(i){return this.http.get(this.baseUrl+"PrintReport/"+i,{responseType:"blob"})}SalesRequestCount(){return this.http.get(this.baseUrl+"SalesRequestCount")}changStatus(i){return this.http.put(this.baseUrl+"ChangeStatus/",i)}GetOrderDetail(i){return this.http.get(this.baseUrl+"GetOrderDetail/"+i)}static{this.\u0275fac=function(u){return new(u||l)(m.KVO(_.Qq))}}static{this.\u0275prov=m.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}}return l})()},53132:(R,f,n)=>{n.d(f,{z:()=>$});var e=n(54438),p=n(99386),m=n(21413),_=n(56977),g=n(37021),l=n(35335),I=n(45236),i=n(70980),u=n(36158),y=n(45312),T=n(55999),C=n(73955),M=n(51188),j=n(3888),E=n(1530),D=n(75922),q=n(60963),b=n(69005),N=n(60177),d=n(89417),P=n(50969),U=n(26364);const G=(a,c)=>({"btn-outline-primary":a,"btn-success":c}),k=a=>({"text-danger":a});function O(a,c){if(1&a&&(e.nrm(0,"app-breadcrumbs",20),e.nI1(1,"translate")),2&a){const t=e.XpG();e.FS9("title",e.bMT(1,2,t.title)),e.Y8G("breadcrumbItems",t.breadCrumbItems)}}function B(a,c){if(1&a&&(e.qex(0),e.j41(1,"option",61),e.EFF(2),e.k0s(),e.bVm()),2&a){const t=c.$implicit;e.R7$(),e.Y8G("value",t.id),e.R7$(),e.JRh(t.name)}}function L(a,c){if(1&a&&(e.qex(0),e.j41(1,"option",61),e.EFF(2),e.k0s(),e.bVm()),2&a){const t=c.$implicit;e.R7$(),e.Y8G("value",t.id),e.R7$(),e.JRh(t.name)}}function S(a,c){if(1&a){const t=e.RV6();e.j41(0,"div",21)(1,"div",22)(2,"label",23),e.bIt("click",function(){e.eBV(t);const r=e.XpG(),o=e.sdS(25);return e.Njj(r.openModal(o))}),e.nrm(3,"a",24),e.j41(4,"span",25),e.EFF(5),e.k0s()()(),e.j41(6,"div",26)(7,"div",27)(8,"input",28),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG();return e.DH7(o.form.customerName,r)||(o.form.customerName=r),e.Njj(r)}),e.k0s(),e.nrm(9,"label",29),e.k0s()(),e.j41(10,"div",26)(11,"div",27)(12,"input",30),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG();return e.DH7(o.form.commercialRegistrationNumber,r)||(o.form.commercialRegistrationNumber=r),e.Njj(r)}),e.k0s(),e.nrm(13,"label",31),e.k0s()(),e.j41(14,"div",32)(15,"div",27)(16,"input",33),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG();return e.DH7(o.form.primaryPhoneNumber,r)||(o.form.primaryPhoneNumber=r),e.Njj(r)}),e.k0s(),e.nrm(17,"label",34),e.k0s()(),e.j41(18,"div",32)(19,"div",27)(20,"input",35),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG();return e.DH7(o.form.taxNumber,r)||(o.form.taxNumber=r),e.Njj(r)}),e.k0s(),e.nrm(21,"label",36),e.k0s()(),e.j41(22,"div",32)(23,"div",27)(24,"select",37),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG();return e.DH7(o.form.clientGroupId,r)||(o.form.clientGroupId=r),e.Njj(r)}),e.DNE(25,B,3,2,"ng-container",38),e.k0s(),e.nrm(26,"label",39),e.k0s()(),e.j41(27,"div",32)(28,"div",27)(29,"select",40),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG();return e.DH7(o.form.customerSize,r)||(o.form.customerSize=r),e.Njj(r)}),e.DNE(30,L,3,2,"ng-container",38),e.k0s(),e.nrm(31,"label",41),e.k0s()(),e.j41(32,"div",26)(33,"div",27)(34,"input",42),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG();return e.DH7(o.form.numberMunicipalLicense,r)||(o.form.numberMunicipalLicense=r),e.Njj(r)}),e.k0s(),e.nrm(35,"label",43),e.k0s()(),e.j41(36,"div",44)(37,"label",45),e.EFF(38,"approvals.customerRequest.externalPhotoPath"),e.k0s(),e.j41(39,"div",46)(40,"div",47)(41,"label",48)(42,"div",49)(43,"div",50),e.nrm(44,"i",51),e.k0s()()(),e.j41(45,"input",52),e.bIt("change",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.fileChange(r))}),e.k0s()(),e.j41(46,"div",53)(47,"div",54),e.nrm(48,"img",55),e.k0s()()()(),e.j41(49,"div",56)(50,"div",57)(51,"button",58),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.goInfoNext())}),e.nrm(52,"i",59)(53,"span",60),e.k0s()()()()}if(2&a){const t=e.XpG();e.R7$(3),e.AVh("link-success",""!=t.form.lat)("link-danger",""==t.form.lat),e.R7$(2),e.SpI(" ",t.address,""),e.R7$(3),e.R50("ngModel",t.form.customerName),e.R7$(4),e.R50("ngModel",t.form.commercialRegistrationNumber),e.R7$(4),e.Y8G("maxlength",10)("minlength",10),e.R50("ngModel",t.form.primaryPhoneNumber),e.R7$(4),e.R50("ngModel",t.form.taxNumber),e.R7$(4),e.R50("ngModel",t.form.clientGroupId),e.R7$(),e.Y8G("ngForOf",t.clientGroups),e.R7$(4),e.R50("ngModel",t.form.customerSize),e.R7$(),e.Y8G("ngForOf",t.companySizes),e.R7$(4),e.R50("ngModel",t.form.numberMunicipalLicense),e.R7$(14),e.Y8G("src",null!=t.form&&t.form.externalPhotoPath?t.mediaUrl+t.form.externalPhotoPath:t.imageURL,e.B4B)}}function A(a,c){if(1&a&&(e.qex(0),e.j41(1,"option",61),e.EFF(2),e.k0s(),e.bVm()),2&a){const t=c.$implicit;e.R7$(),e.Y8G("value",t.id),e.R7$(),e.JRh(t.name)}}function w(a,c){if(1&a){const t=e.RV6();e.j41(0,"div",62)(1,"div",26)(2,"div",27)(3,"input",63),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG();return e.DH7(o.form.buildingNumber,r)||(o.form.buildingNumber=r),e.Njj(r)}),e.k0s(),e.nrm(4,"label",64),e.k0s()(),e.j41(5,"div",26)(6,"div",27)(7,"input",65),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG();return e.DH7(o.form.subNumber,r)||(o.form.subNumber=r),e.Njj(r)}),e.k0s(),e.nrm(8,"label",66),e.k0s()(),e.j41(9,"div",32)(10,"div",27)(11,"input",67),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG();return e.DH7(o.form.postalCode,r)||(o.form.postalCode=r),e.Njj(r)}),e.k0s(),e.nrm(12,"label",68),e.k0s()(),e.j41(13,"div",32)(14,"div",27)(15,"input",69),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG();return e.DH7(o.form.district,r)||(o.form.district=r),e.Njj(r)}),e.k0s(),e.nrm(16,"label",70),e.k0s()(),e.j41(17,"div",32)(18,"div",27)(19,"select",71),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG();return e.DH7(o.form.cityId,r)||(o.form.cityId=r),e.Njj(r)}),e.DNE(20,A,3,2,"ng-container",38),e.k0s(),e.nrm(21,"label",72),e.k0s()(),e.j41(22,"div",56)(23,"div",73)(24,"button",74),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.activeTabId=1)}),e.nrm(25,"i",75)(26,"span",76),e.k0s(),e.j41(27,"button",77),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.goAddressNext())}),e.nrm(28,"i",59)(29,"span",60),e.k0s()()()()}if(2&a){const t=e.XpG();e.R7$(3),e.R50("ngModel",t.form.buildingNumber),e.R7$(4),e.R50("ngModel",t.form.subNumber),e.R7$(4),e.R50("ngModel",t.form.postalCode),e.R7$(4),e.R50("ngModel",t.form.district),e.R7$(4),e.R50("ngModel",t.form.cityId),e.R7$(),e.Y8G("ngForOf",t.cities)}}function F(a,c){if(1&a){const t=e.RV6();e.j41(0,"div",90)(1,"input",91),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG(2);return e.DH7(o.selectedType,r)||(o.selectedType=r),e.Njj(r)}),e.k0s(),e.j41(2,"label",92),e.bIt("click",function(){const r=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.onTypeChange(r.id))}),e.j41(3,"span",93),e.EFF(4),e.nI1(5,"translate"),e.k0s()()()}if(2&a){const t=c.$implicit,s=e.XpG(2);e.R7$(),e.Y8G("id",t.id)("value",t.id),e.R50("ngModel",s.selectedType),e.R7$(),e.Y8G("ngClass",e.l_i(9,G,!t.isUploaded,t.isUploaded))("for",t.id),e.R7$(),e.Y8G("ngClass",e.eq3(12,k,t.isRequired)),e.R7$(),e.SpI(" ",e.bMT(5,7,"approvals.customerRequest."+t.label)," ")}}function V(a,c){if(1&a){const t=e.RV6();e.j41(0,"div",95),e.nrm(1,"i",96),e.j41(2,"strong",97),e.bIt("click",function(){e.eBV(t);const r=e.XpG().$implicit,o=e.XpG(2);return e.Njj(o.viewFile(r.id))}),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.j41(5,"button",98),e.bIt("click",function(){e.eBV(t);const r=e.XpG().$implicit,o=e.XpG(2);return e.Njj(o.removeFile(r.id))}),e.nrm(6,"span",99),e.k0s()()}if(2&a){const t=e.XpG().$implicit;e.R7$(3),e.SpI(" ",e.bMT(4,1,"approvals.customerRequest."+t.label)," ")}}function X(a,c){if(1&a&&(e.j41(0,"div"),e.DNE(1,V,7,3,"div",94),e.k0s()),2&a){const t=c.$implicit,s=e.XpG(2);e.R7$(),e.Y8G("ngIf",s.filesByType[t.id])}}function z(a,c){if(1&a){const t=e.RV6();e.nrm(0,"h5",78),e.j41(1,"div",79),e.DNE(2,F,6,14,"div",80),e.k0s(),e.j41(3,"dropzone",81,2),e.bIt("error",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.onFileError(r))})("addedFile",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.onFileAdded(r))}),e.k0s(),e.j41(5,"div",82),e.nrm(6,"h5",83),e.DNE(7,X,2,1,"div",38),e.k0s(),e.j41(8,"div",84)(9,"button",85),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.activeTabId=2)}),e.nrm(10,"i",75)(11,"span",86),e.k0s(),e.j41(12,"button",87),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.onSubmit())}),e.nrm(13,"i",88)(14,"span",89),e.k0s()()}if(2&a){const t=e.XpG();e.R7$(2),e.Y8G("ngForOf",t.documentTypes),e.R7$(),e.Y8G("config",t.config)("useDropzoneClass",!1),e.R7$(4),e.Y8G("ngForOf",t.documentTypes)}}function K(a,c){if(1&a){const t=e.RV6();e.j41(0,"div",100)(1,"div",101),e.nrm(2,"lord-icon",102)(3,"h5",103),e.j41(4,"div",104)(5,"button",105),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.activeTabId=1)}),e.nrm(6,"i",106)(7,"span",107),e.k0s()()()()}}function W(a,c){if(1&a){const t=e.RV6();e.j41(0,"div",108)(1,"div",109),e.nrm(2,"h3",110),e.j41(3,"button",111),e.bIt("click",function(){const r=e.eBV(t).$implicit;return e.Njj(r.dismiss())}),e.k0s()(),e.j41(4,"div",112)(5,"google-map",113),e.bIt("mapClick",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.onMapClick(r))}),e.nrm(6,"map-marker",114),e.k0s(),e.j41(7,"div",115)(8,"button",116),e.bIt("click",function(){const r=e.eBV(t).$implicit;return e.Njj(r.dismiss())}),e.k0s(),e.j41(9,"button",117),e.bIt("click",function(){const r=e.eBV(t).$implicit;return e.Njj(r.dismiss())}),e.k0s()()()()}if(2&a){const t=e.XpG();e.R7$(5),e.Y8G("options",t.mapOptions)("center",t.center)("zoom",t.zoom),e.R7$(),e.Y8G("position",t.markerPosition)}}let $=(()=>{class a{constructor(t,s,r,o,v,h,Y,H,Q){this.requestNewCustomerService=t,this.translateService=s,this.router=r,this.alertService=o,this.ngxLoader=v,this.clientService=h,this._activatedRoute=Y,this.paramsEncryptionService=H,this.modalService=Q,this.title="approvals.customerRequest.title",this.center={lat:0,lng:0},this.zoom=20,this.markerPosition=null,this.mapOptions={disableDefaultUI:!0,draggable:!1,gestureHandling:"none",zoomControl:!0},this.form={},this.isEdit=!1,this.errors=[],this.showBreadcrumbs=!0,this.notifier=new m.B,this.clientGroups=[],this.companySizes=[],this.cities=[],this.activeTabId=1,this.visitId=1,this.filesByType={},this.selectedType="commercialRegister",this.documentTypes=[{id:"commercialRegister",label:"commercialRegister",isUploaded:!1,isRequired:!0},{id:"municipalLicense",label:"municipalLicense",isUploaded:!1,isRequired:!0},{id:"nationalAddressProof",label:"nationalAddress",isUploaded:!1,isRequired:!0},{id:"vatCertificate",label:"vatCertificate",isUploaded:!1,isRequired:!0},{id:"ownerId",label:"customerID",isUploaded:!1,isRequired:!1},{id:"dealAgreement",label:"dealAgreement",isUploaded:!1,isRequired:!1}],this.config={dictInvalidFileType:"",url:"noop",autoProcessQueue:!1,maxFiles:1,maxFilesize:1,acceptedFiles:"image/*,application/pdf",addRemoveLinks:!0,dictDefaultMessage:this.getTranslationText("approvals.customerRequest.dropMsg")},this.loaderOperationShap=u.$$,this.operationLoader=u.ZW,this.mediaUrl=y.c.mediaUrl,this.OnStepChange=new e.bkB,this.address="",this.maxSizeInBytes=1048576,this._activatedRoute.queryParams.subscribe(Z=>{let x=this.paramsEncryptionService.decrypt(Z.visitId,"visitId");this.form.visitId=+x,this.visitId=+x}),this.getUserLocation()}ngOnInit(){this.getLoopus(),this.isEdit&&this.checkMedia(),this.setCurrentLocation()}checkMedia(){const t={commercialRegister:this.form.commercialRegisterPath,municipalLicense:this.form.municipalLicensePath,nationalAddressProof:this.form.nationalAddressProofPath,vatCertificate:this.form.vatCertificatePath,ownerId:this.form.ownerIdPath,dealAgreement:this.form.dealAgreementPath};this.documentTypes=this.documentTypes.filter(s=>{const r=t[s.id];return!r||""===r.trim()})}ngAfterViewInit(){const t=this.dropzoneDirective.el.nativeElement.querySelector('input[type="file"]');t&&t.setAttribute("capture","camera")}getLoopus(){this.requestNewCustomerService.GetLookups().subscribe(t=>{this.clientGroups=t.data.clientGroup,this.cities=t.data.cities;let s=t.data.size;s.forEach(r=>{r.name=this.getTranslationText("approvals.customerRequest."+r.name)}),this.companySizes=s})}getCurrentLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{this.center={lat:t.coords.latitude,lng:t.coords.longitude},this.markerPosition=this.center},t=>{console.error("Geolocation error:",t),alert("Failed to get location.")}):alert("Geolocation is not supported.")}getTranslationText(t){let s="";return this.translateService.get(t).pipe((0,_.Q)(this.notifier)).subscribe(r=>{s=r}),s}goInfoNext(){return this.form.customerName?this.form.commercialRegistrationNumber?this.form.primaryPhoneNumber?this.form.taxNumber?this.form.clientGroupId?this.form.customerSize?(this.form.externalPhoto||this.form.externalPhotoPath)&&(this.form.lng||this.form.lat)?(this.activeTabId=2,!0):(this.alertService.error("general.message.filedIdRequired"),!1):(this.alertService.error("approvals.customerRequest.customerSizeRequired"),!1):(this.alertService.error("approvals.customerRequest.clientGroupIdRequired"),!1):(this.alertService.error("approvals.customerRequest.taxNumberRequired"),!1):(this.alertService.error("approvals.customerRequest.primaryPhoneNumberRequired"),!1):(this.alertService.error("approvals.customerRequest.commercialRegistrationNumberRequired"),!1):(this.alertService.error("approvals.customerRequest.customerNameRequired"),!1)}goAddressNext(){return this.form.buildingNumber&&this.form.subNumber&&this.form.postalCode&&this.form.district&&this.form.cityId?(this.activeTabId=3,!0):(this.alertService.error("general.message.filedIdRequired"),!1)}onFileError(t){}onFileAdded(t){if(t.size>this.maxSizeInBytes)return this.alertService.error("\u062d\u062c\u0645 \u0627\u0644\u0645\u0644\u0641 \u0643\u0628\u064a\u064a\u0631"),void this.dropzoneDirective.removeFile(t);if(this.filesByType[this.selectedType])return;this.filesByType[this.selectedType]=t;const s=this.documentTypes.find(r=>r.id===this.selectedType);s&&(s.isUploaded=!0)}removeFile(t){delete this.filesByType[t];const s=this.documentTypes.find(r=>r.id===t);s&&(s.isUploaded=!1)}onTypeChange(t){this.selectedType=t,this.clearDropzone()}clearDropzone(){this.directiveRef?this.directiveRef.reset():this.componentRef&&this.componentRef.directiveRef&&this.componentRef.directiveRef.reset()}fileChange(t){if(this.form.externalPhoto=t.target.files[0],this.form.externalPhoto>this.maxSizeInBytes)return void this.alertService.error("\u062d\u062c\u0645 \u0627\u0644\u0645\u0644\u0641 \u0643\u0628\u064a\u064a\u0631");document.getElementById("");const r=new FileReader;r.onload=()=>{this.imageURL=r.result,document.getElementById("externalPhotoPath").src=this.imageURL},r.readAsDataURL(this.form.externalPhoto)}onSubmit(){this.checkStatusDocs()&&(this.ngxLoader.startLoader(this.operationLoader),this.isEdit?this.UpdateClient():this.Register())}UpdateClient(){let t=this.mapClientUpdateForm();this.clientService.agentSalesEdit(this.form.id,t).pipe((0,g.O)(),(0,l.c)(50),(0,I.Z)(),(0,_.Q)(this.notifier),(0,i.j)(()=>this.ngxLoader.stopLoader(u.ZW))).subscribe(s=>{s.success?(this.OnStepChange.emit(1),this.visitId&&this.router.navigate(["/sales/startVisits"],{state:{id:this.visitId}}),this.alertService.success()):this.alertService.error("general.message."+s.message)},s=>{this.alertService.error("general.message."+s)})}Register(){let t=this.mapForm();this.requestNewCustomerService.register(t).pipe((0,g.O)(),(0,l.c)(100),(0,I.Z)(),(0,_.Q)(this.notifier),(0,i.j)(()=>this.ngxLoader.stopLoader(this.operationLoader))).subscribe(s=>{s.success?(this.form={},this.visitId&&this.router.navigate(["/sales/startVisits"],{state:{id:this.visitId}}),this.filesByType={},this.activeTabId=4,this.imageURL=""):this.alertService.error("general.message."+s.message)},()=>{this.alertService.error()})}checkStatusDocs(){let t=!0;return this.documentTypes.filter(r=>r.isRequired&&!r.isUploaded).map(r=>r.label).length>0&&(this.alertService.error("approvals.customerRequest.uploadRequiredDoc"),t=!1),t}mapForm(){const t=new FormData;return Object.keys(this.filesByType).forEach(s=>{const r=this.filesByType[s];r&&t.append(s,r,r.name)}),Object.keys(this.form).forEach(s=>{"files"!==s&&t.append(s,this.form[s])}),t}mapClientUpdateForm(){let t={agentCode:this.form.id,agentName:this.form.customerName,mobile:this.form.primaryPhoneNumber,cityCode:this.form.cityId,clientGroupId:this.form.clientGroupId,nationalAddress:this.form.nationalAddress,vatNumber:this.form.taxNumber,postalCode:this.form.postalCode,buildingNumber:this.form.buildingNumber,subNumber:this.form.subNumber,district:this.form.district,lng:this.form.lng,lat:this.form.lat,customerSize:this.form.customerSize,commercialRegistrationNumber:this.form.commercialRegistrationNumber,externalPhoto:this.form.externalPhoto?this.form.externalPhoto:"",externalPhotoPath:this.form.externalPhotoPath,commercialRegisterPath:this.form.commercialRegisterPath,municipalLicensePath:this.form.municipalLicensePath,nationalAddressProofPath:this.form.nationalAddressProofPath,ownerIdPath:this.form.ownerIdPath,vatCertificatePath:this.form.vatCertificatePath,dealAgreementPath:this.form.dealAgreementPath};const s=new FormData;return Object.keys(this.filesByType).forEach(r=>{const o=this.filesByType[r];o&&s.append(r,o,o.name)}),Object.keys(t).forEach(r=>{"files"!==r&&s.append(r,t[r])}),s}onNavChange(t){let s=!1;2===t.nextId?(s=this.goInfoNext(),s||t.preventDefault()):3===t.nextId?(s=this.goAddressNext(),s||t.preventDefault()):4===t.nextId&&t.preventDefault()}getUserLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{this.center={lat:t.coords.latitude,lng:t.coords.longitude}},t=>{console.error("Error getting location: ",t)}):console.error("Geolocation not supported by this browser.")}onMapClick(t){}openModal(t,s="lg"){this.modalService.open(t,{centered:!0,size:s})}setCurrentLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{this.center={lat:t.coords.latitude,lng:t.coords.longitude},this.form.lat=this.center.lat,this.form.lng=this.center.lng,this.markerPosition=this.center,this.getAddressFromCoords(this.center.lat,this.center.lng)},t=>{console.error("Geolocation error:",t)}):console.warn("Geolocation is not supported by this browser.")}getAddressFromCoords(t,s){(new google.maps.Geocoder).geocode({location:{lat:t,lng:s}},(v,h)=>{"OK"===h&&v&&v.length>0?this.address=v[0].formatted_address:console.error("Geocoder failed due to:",h)})}viewFile(t){const s=this.filesByType[t];if(s){const r=URL.createObjectURL(s);window.open(r,"_blank")}}static{this.\u0275fac=function(s){return new(s||a)(e.rXU(T.T),e.rXU(C.c$),e.rXU(M.Ix),e.rXU(j.u),e.rXU(E.eD),e.rXU(D.X),e.rXU(M.nX),e.rXU(q.h),e.rXU(b.Bq))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["requestNewCustomer"]],viewQuery:function(s,r){if(1&s&&(e.GBs(p.HF,5),e.GBs(p.XQ,5),e.GBs(p.XQ,5)),2&s){let o;e.mGM(o=e.lsd())&&(r.componentRef=o.first),e.mGM(o=e.lsd())&&(r.directiveRef=o.first),e.mGM(o=e.lsd())&&(r.dropzoneDirective=o.first)}},inputs:{form:"form",isEdit:"isEdit",errors:"errors",showBreadcrumbs:"showBreadcrumbs"},outputs:{OnStepChange:"OnStepChange"},decls:26,vars:10,consts:[["customNav","ngbNav"],["openMap",""],["dropzoneDirective",""],[3,"title","breadcrumbItems",4,"ngIf"],["action","#",1,"checkout-tab"],[1,"row","customer-drop","justify-content-center"],[1,"card","col-12","col-md-8"],[1,"card-body"],[3,"hasProgressBar","fgsType","loaderId"],[1,"step-arrow-nav"],["ngbNav","","role","tablist",1,"nav","nav-pills","custom-nav","nav-justified",3,"navChange","activeIdChange","activeId"],[1,"nav-item",3,"ngbNavItem"],["ngbNavLink","","data-bs-toggle","tab","role","tab","translate","approvals.customerRequest.customerInfo",1,"nav-link","p-2"],["ngbNavContent",""],["ngbNavLink","","data-bs-toggle","tab","role","tab","translate","approvals.customerRequest.nationalAddressData",1,"nav-link","p-2"],["ngbNavLink","","data-bs-toggle","tab","role","tab","translate","approvals.customerRequest.officialDocuments",1,"nav-link","p-2"],["ngbNavLink","","data-bs-toggle","tab","role","tab","translate","approvals.customerRequest.verified",1,"nav-link","p-2"],[1,"modal-body"],[1,"tab-content"],[3,"ngbNavOutlet"],[3,"title","breadcrumbItems"],[1,"row","mt-1","p-1"],[1,"col-12"],["for","notes",1,"w-bold","form-label",3,"click"],["href","javascript:void(0)","translate","approvals.customerRequest.currentLocation",1,"required","link-success","link-offset-2","text-decoration-underline","link-underline-opacity-25","link-underline-opacity-100-hover","fs-4"],[1,"mx-3"],[1,"col-12","col-md-6","my-2"],[1,"form-floating"],["type","text","name","customerName","id","customerName","placeholder"," ",1,"form-control",3,"ngModelChange","ngModel"],["for","customerName","translate","approvals.customerRequest.customerName",1,"required"],["type","number","name","commercialRegistrationNumber","id","commercialRegistrationNumber","placeholder"," ",1,"form-control",3,"ngModelChange","ngModel"],["for","commercialRegistrationNumber","translate","approvals.customerRequest.commercialRegistrationNumber",1,"required"],[1,"col-12","col-md-6","my-3"],["type","number","name","primaryPhoneNumber","id","primaryPhoneNumber","placeholder"," ",1,"form-control",3,"ngModelChange","maxlength","minlength","ngModel"],["for","primaryPhoneNumber","translate","approvals.customerRequest.primaryPhoneNumber",1,"required"],["type","number","name","taxNumber","id","taxNumber","placeholder"," ",1,"form-control",3,"ngModelChange","ngModel"],["for","taxNumber","translate","approvals.customerRequest.taxNumber",1,"required"],["name","clientGroupId","id","clientGroupId","aria-label","Floating label select example",1,"form-select",3,"ngModelChange","ngModel"],[4,"ngFor","ngForOf"],["for","clientGroupId","translate","approvals.customerRequest.clientGroup",1,"required"],["name","customerSize","id","customerSize","aria-label","Floating label select example",1,"form-select",3,"ngModelChange","ngModel"],["for","customerSize","translate","approvals.customerRequest.customerSize",1,"required"],["type","number","name","numberMunicipalLicense","id","numberMunicipalLicense","placeholder"," ",1,"form-control",3,"ngModelChange","ngModel"],["for","numberMunicipalLicense","translate","client.client.numberMunicipalLicense",1,"required"],[1,"col-12","col-md-6","mt-0"],["for","notes","translate","",1,"fw-bold","form-label","required"],[1,"position-relative","d-inline-block","w-100"],[1,"position-absolute","top-100","start-100","translate-middle"],["for","product-image-input","placement","right","ngbTooltip","Select Image",1,"mb-0"],[1,"avatar-xs"],[1,"avatar-title","bg-light","border","rounded-circle","text-muted","cursor-pointer"],[1,"ri-image-fill"],["value","","id","product-image-input","type","file","accept","image/png, image/gif, image/jpeg",1,"form-control","d-none",3,"change"],[1,"avatar-lg","w-100"],[1,"avatar-title","bg-light","rounded"],["id","externalPhotoPath",1,"avatar-md","h-auto",3,"src"],[1,"col-lg-12"],[1,"d-flex","align-items-start","gap-3","mt-3"],["type","button","data-nexttab","pills-bill-address-tab",1,"btn","btn-primary","btn-label","right","ms-auto","nexttab",3,"click"],[1,"ri-arrow-right-line","label-icon","align-middle","fs-16","ms-2","next-btn"],["translate","general.action.next"],["selected","",3,"value"],[1,"row","p-2"],["name","buildingNumber","type","number","id","buildingNumber","placeholder"," ",1,"form-control",3,"ngModelChange","ngModel"],["for","buildingNumber","translate","approvals.customerRequest.buildingNumber",1,"required"],["name","subNumber","type","number","id","subNumber","placeholder"," ",1,"form-control",3,"ngModelChange","ngModel"],["for","subNumber","translate","approvals.customerRequest.subNumber",1,"required"],["name","postalCode","type","number","id","postalCode","placeholder"," ",1,"form-control",3,"ngModelChange","ngModel"],["for","postalCode","translate","approvals.customerRequest.postalCode",1,"required"],["name","district","type","text","id","district","placeholder"," ",1,"form-control",3,"ngModelChange","ngModel"],["for","district","translate","approvals.customerRequest.district",1,"required"],["name","cityId","id","cityId","aria-label","Floating label select example",1,"form-select",3,"ngModelChange","ngModel"],["for","cityId","translate","approvals.customerRequest.city",1,"required"],[1,"hstack","align-items-start","gap-3","mt-4"],["type","button","data-previous","pills-bill-info-tab",1,"btn","btn-light","btn-label","previestab",3,"click"],[1,"ri-arrow-left-line","label-icon","align-middle","fs-16","me-2","pre-btn"],["translate","approvals.customerRequest.customerInfo"],["type","button","data-nexttab","pills-payment-tab",1,"btn","btn-primary","btn-label","right","ms-auto","nexttab",3,"click"],["translate","approvals.customerRequest.chooseDocumentType",1,"mb-3"],[1,"d-flex","gap-2","py-3","flex-wrap"],["class","  position-relative",4,"ngFor","ngForOf"],[1,"dropzone_sec",3,"error","addedFile","config","useDropzoneClass"],[1,"mt-4"],["translate","approvals.customerRequest.uploadedDocument"],[1,"d-flex","align-items-start","py-3"],["type","button","data-previous","pills-bill-address-tab",1,"btn","btn-light","btn-label","previestab",3,"click"],["translate","approvals.customerRequest.nationalAddressData"],["type","button","data-nexttab","pills-finish-tab",1,"btn","btn-primary","btn-label","right","ms-auto","nexttab",3,"click"],[1,"ri-save-line","label-icon","align-middle","fs-16","ms-2"],["translate","general.action.save"],[1,"position-relative"],["type","radio","name","doc-type",1,"btn-check",3,"ngModelChange","id","value","ngModel"],[1,"btn",3,"click","ngClass","for"],[3,"ngClass"],["class","d-flex align-items-center gap-3 my-2",4,"ngIf"],[1,"d-flex","align-items-center","gap-3","my-2"],[1,"ri-file-text-line"],[1,"text-primary","text-decoration-underline","cursor-pointer",3,"click"],[1,"btn","btn-sm","btn-danger",3,"click"],["translate","general.action.delete"],[1,"row","text-center","justify-content-center"],[1,"col-lg-11"],["src","https://cdn.lordicon.com/lupuorrc.json","trigger","loop","colors","primary:#0ab39c,secondary:#405189",2,"width","120px","height","120px"],["translate","approvals.customerRequest.requestSended"],[1,"hstack","justify-content-center","py-3"],["type","button",1,"btn","btn-success",3,"click"],[1,"ri-home-4-line","align-bottom","ms-1"],["translate","approvals.customerRequest.newRequest"],[1,"modal-content"],[1,"modal-header"],["translate","approvals.customerRequest.currentLocation"],["type","button","data-bs-dismiss","modal","aria-label","Close","id","btn-close",1,"btn-close",3,"click"],[1,"modal-body","p-1"],["height","500px","width","100%",3,"mapClick","options","center","zoom"],[3,"position"],[1,"d-flex","gap-2","justify-content-center","mt-4","mb-2"],["type","button","data-bs-dismiss","modal","translate","general.action.sure",1,"btn","w-sm","btn-success","fs-6",3,"click"],["type","button","data-bs-dismiss","modal","translate","general.action.close",1,"btn","w-sm","btn-danger","fs-6",3,"click"]],template:function(s,r){if(1&s){const o=e.RV6();e.DNE(0,O,2,4,"app-breadcrumbs",3),e.j41(1,"form",4)(2,"div",5)(3,"div",6)(4,"div",7),e.nrm(5,"ngx-ui-loader",8),e.j41(6,"div",9)(7,"ul",10,0),e.bIt("navChange",function(h){return e.eBV(o),e.Njj(r.onNavChange(h))}),e.mxI("activeIdChange",function(h){return e.eBV(o),e.DH7(r.activeTabId,h)||(r.activeTabId=h),e.Njj(h)}),e.j41(9,"li",11),e.nrm(10,"a",12),e.DNE(11,S,54,17,"ng-template",13),e.k0s(),e.j41(12,"li",11),e.nrm(13,"a",14),e.DNE(14,w,30,6,"ng-template",13),e.k0s(),e.j41(15,"li",11),e.nrm(16,"a",15),e.DNE(17,z,15,4,"ng-template",13),e.k0s(),e.j41(18,"li",11),e.nrm(19,"a",16),e.DNE(20,K,8,0,"ng-template",13),e.k0s()()()(),e.j41(21,"div",17)(22,"div",18),e.nrm(23,"div",19),e.k0s()()()()(),e.DNE(24,W,10,4,"ng-template",null,1,e.C5r)}if(2&s){const o=e.sdS(8);e.Y8G("ngIf",r.showBreadcrumbs),e.R7$(5),e.Y8G("hasProgressBar",!1)("fgsType",r.loaderOperationShap)("loaderId",r.operationLoader),e.R7$(2),e.R50("activeId",r.activeTabId),e.R7$(2),e.Y8G("ngbNavItem",1),e.R7$(3),e.Y8G("ngbNavItem",2),e.R7$(3),e.Y8G("ngbNavItem",3),e.R7$(3),e.Y8G("ngbNavItem",4),e.R7$(5),e.Y8G("ngbNavOutlet",o)}},dependencies:[N.YU,N.Sq,N.bT,b.Um,b.X9,b.sy,b.Gx,b.Ri,b.WA,b.m_,d.qT,d.xH,d.y7,d.me,d.Q0,d.wz,d.Fm,d.BC,d.cb,d.xh,d.tU,d.vS,d.cV,C.Mm,E.Cv,P.u6,P.fU,b.md,p.HF,U.m,C.D9],encapsulation:2})}}return a})()}}]);